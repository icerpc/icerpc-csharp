# Slice Tools for IceRPC

IceRpc.Slice.Tools allows you to compile Slice definitions (in `.slice` files) into C# code (in `.cs` files) within
MSBuild projects. The generated C# code depends on the [IceRpc][icerpc] NuGet package.

This package includes the Slice compiler for C#, `slicec-cs`. This compiler is a native tool with binaries for Linux
(x64 and arm64), macOS (x64 and arm64) and Windows (x64).

Once you've added the IceRpc.Slice.Tools NuGet package to your project, the Slice files of your project are
automatically compiled into C# files every time you build this project.

> When `slicec-cs` compiles a Slice file and the resulting .cs file is identical to the existing output .cs file,
> the existing .cs file is kept as-is; the output file is overwritten only when something changed.

[Source code][source] | [Package][package] | [slicec-cs documentation][slicec-cs] | [Slice documentation][slice]

## Slice files and Slice directories

The Slice compiler for C# accepts two main inputs:
 - the Slice files to compile into C# code (the Slice files)
 - directories that contain reference Slice files (the Slice directories)

The Slice compiler parses the reference Slice files found in the Slice directories but does not generate code for them.
They typically contain definitions referenced by the source Slice files.

> The Slice files and Slice directories can overlap.

You select which files to include in your project's Slice files with the `SliceFile` item type. And you select which
directory to include in your project's Slice directories with the `SliceDirectory` item type.

By default, all `.slice` files located in your project's home directory and any of its subdirectories, recursively, are
included in `SliceFile`. You can prevent this auto-inclusion of `.slice` files by setting either
[`EnableDefaultItems`][default_items] or `EnableDefaultSliceFileItems` to `false`. The default value of these properties
is `true`.

You can also add files to your Slice files explicitly. For example:
```xml
<ItemGroup>
    <SliceFile Include="../Greeter.slice"/>
</ItemGroup>
```

This adds `Greeter.slice` to your project's Slice files even though this file is not in the project's home directory or
any of its subdirectories.

> Slice files must have a `.slice` extension.

The Slice directories are an aggregate of the `SliceDirectory` defined in your project (if any) and the `SliceDirectory`
defined in NuGet packages referenced by your project.

For example:
```xml
<ItemGroup>
    <!-- My Slice files reference definitions in this Slice directory -->
    <SliceDirectory Include="$(MSBuildThisFileDirectory)../slice"/>
</ItemGroup>
```

## Slice directory and NuGet Package

As a general rule, when you package an assembly in a NuGet package and this assembly exports C# symbols generated by the
Slice compiler for C#, you should include the corresponding Slice files in your NuGet package. This allows consumers of
your NuGet package to easily retrieve and reference these Slice files.

The IceRpc NuGet package follows this rule and includes a number of Slice files. In particular, it provides definitions
for common Slice types such as WellKnownTypes::Duration, WellKnownTypes::TimeStamp and WellKnownTypes::Uri, and Ice
interop types such as Ice::Object and Ice::IdentityPath.

The IceRpc NuGet package also defines a `SliceDirectory` that points to these Slice files. This way, any project that
references the IceRpc NuGet package automatically references this Slice directory when compiling its own Slice files.

## SliceFile item metadata

You can use the following `SliceFile` item metadata to customize the compilation and packaging of your Slice files. Each
unique set of options results in a separate execution of `slicec-cs`.

| Name              | Default   | Description                                                                                                                                                                                    |
|-------------------|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AdditionalOptions |           | Specifies additional options to pass to `slicec-cs`.                                                                                                                                           |
| OutputDir         | generated | Sets the output directory for the generated code. This metadata corresponds to the `--output-dir` option of `slicec-cs`.                                                                       |
| Pack              | `false`   | Specifies whether or not to include the items (Slice files) in the NuGet package. When `true`, the NuGet package also defines a `SliceDirectory` item that points to the value of PackagePath. |
| PackagePath       | slice     | Sets the target path in the NuGet package. Used only when Pack is `true`.                                                                                                                      |

[default_items]: https://learn.microsoft.com/en-us/dotnet/core/project-sdk/msbuild-props#enabledefaultitems
[icerpc]: https://www.nuget.org/packages/IceRpc
[package]: https://www.nuget.org/packages/IceRpc.Slice.Tools
[slice]: https://docs.testing.zeroc.com/docs/slice
[slicec-cs]: TODO
[source]: https://github.com/icerpc/icerpc-csharp/tree/main/src/tools.IceRpc.Slice.Tools
