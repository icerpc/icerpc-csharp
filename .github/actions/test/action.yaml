name: Run Tests

runs:
  using: "composite"
  steps:
  - name: ðŸ§ª Test Slice Compiler
    run: cargo test --manifest-path tools/slicec-cs/Cargo.toml
    shell: bash
  - name: ðŸ§ª Test
    run: dotnet test --no-build --blame-crash --blame-hang-timeout 10s --diag ${{ github.workspace}}/diag.log
    shell: bash
  - name: Upload diag log
    uses: actions/upload-artifact@v4
    with:
      name: diag-log-${{ runner.os }}
      path: ${{ github.workspace }}/diag.log
      if-no-files-found: ignore
  # When using --blame-hang-timeout
  - name: Upload hang dumps
    uses: actions/upload-artifact@v4
    with:
      name: hang-dumps-${{ runner.os }}
      path: ${{ github.workspace }}/**/*.dmp
      if-no-files-found: ignore
    if: failure()
